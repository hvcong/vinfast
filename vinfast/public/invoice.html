<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1024, initial-scale=0.5, maximum-scale=2.0, user-scalable=yes">
    <title>Invoice - VinFast</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

    body {
      font-family: 'Times New Roman', Times, serif;
      background-color: #ffffff;
      padding: 10px;
      font-size: 11px;
    }        .invoice-container {
            max-width: 850px;
            margin: 0 auto;
            background-color: white;
            padding: 15px;
            border: none;
        }

        /* Header */
        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px solid #000000;
        }

        .company-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-right: 10px;
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .company-text h1 {
            color: #000000;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .company-text p {
            color: #000000;
            font-size: 10px;
            line-height: 1.3;
        }

        .invoice-title {
            text-align: right;
        }

        .invoice-title h2 {
            font-size: 20px;
            color: #000000;
            margin-bottom: 5px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .invoice-title p {
            color: #000000;
            font-size: 10px;
            font-weight: 500;
        }

        /* Customer Info */
        .customer-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 8px;
            margin-bottom: 12px;
            padding: 10px;
            background-color: #ffffff;
            border: 1px solid #000000;
        }

        .info-block h3 {
            font-size: 9px;
            color: #000000;
            margin-bottom: 3px;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .info-block p {
            font-size: 11px;
            color: #000000;
            line-height: 1.3;
            font-weight: 400;
        }

        .info-block p strong {
            font-weight: 700;
            color: #000000;
        }

        /* Product Table */
        .product-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 12px;
            margin-top: 12px;
            border: 1px solid #000000;
        }

        .product-table thead {
            background-color: #ffffff;
            border-bottom: 1px solid #000000;
        }

        .product-table th {
            padding: 8px 8px;
            text-align: left;
            font-size: 10px;
            font-weight: 700;
            color: #000000;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid #000000;
        }

        .product-table th:nth-child(2),
        .product-table th:nth-child(3),
        .product-table th:nth-child(4),
        .product-table th:nth-child(5) {
            text-align: right;
        }

        .product-table td {
            padding: 8px 8px;
            font-size: 11px;
            color: #000000;
            border: 1px solid #000000;
        }

        .product-table td:nth-child(2),
        .product-table td:nth-child(3),
        .product-table td:nth-child(4),
        .product-table td:nth-child(5) {
            text-align: right;
            font-weight: 400;
        }

        .product-name {
            font-weight: 700;
            margin-bottom: 3px;
            color: #000000;
        }

        .product-description {
            font-size: 10px;
            color: #000000;
            line-height: 1.3;
        }

        /* Totals */
        .totals-section {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .totals {
            width: 100%;
            background-color: #ffffff;
            padding: 10px;
            border: 1px solid #000000;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 11px;
            font-weight: 400;
            color: #000000;
        }

        .total-row span:last-child {
            color: #000000;
            font-weight: 700;
        }

        .total-row.subtotal {
            border-top: 1px solid #000000;
            padding-top: 6px;
            margin-top: 4px;
        }

        .total-row.grand-total {
            border-top: 2px solid #000000;
            font-weight: 700;
            font-size: 13px;
            color: #000000;
            padding-top: 6px;
            margin-top: 5px;
        }

        .total-row.grand-total span:last-child {
            color: #000000;
            font-weight: 700;
        }

        /* Payment Section */
        .payment-section {
            margin-top: 12px;
            padding: 10px;
            background-color: #ffffff;
            border: 1px solid #000000;
        }

        .payment-section h3 {
            font-size: 11px;
            color: #000000;
            margin-bottom: 8px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .payment-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 6px;
        }

        .payment-item {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            padding: 6px 8px;
            background-color: white;
            border: 1px solid #000000;
        }

        .payment-item .label {
            color: #000000;
            font-weight: 400;
        }

        .payment-item .value {
            font-weight: 700;
            color: #000000;
        }

        /* Footer */
        .invoice-footer {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 2px solid #000000;
            text-align: center;
        }

        .invoice-footer p {
            color: #000000;
            font-size: 10px;
            line-height: 1.4;
            margin: 2px 0;
        }

        .invoice-footer strong {
            color: #000000;
            font-size: 11px;
            font-weight: 700;
        }

        /* Print Styles */
        @media print {
            body {
                background-color: white;
                padding: 0;
                font-size: 10px;
            }

            .invoice-container {
                box-shadow: none;
                padding: 15px;
                max-width: 100%;
                margin: 0;
            }

            .no-print,
            .action-buttons {
                display: none !important;
            }

            .invoice-footer {
                page-break-inside: avoid;
            }

            /* Show logo in print */
            .logo-icon {
                display: flex !important;
                width: 100px;
                height: 100px;
            }

            .company-info {
                gap: 8px !important;
            }

            /* Reduce spacing for print */
            .invoice-header {
                margin-bottom: 8px;
                padding-bottom: 8px;
            }

            .customer-section {
                margin-bottom: 8px;
                padding: 8px;
                gap: 8px;
            }

            .product-table {
                margin-top: 8px;
                margin-bottom: 8px;
            }

            .totals-section {
                margin-top: 8px;
                margin-bottom: 8px;
            }

            .payment-section {
                margin-top: 8px;
                padding: 8px;
            }

            .invoice-footer {
                margin-top: 10px;
                padding-top: 8px;
            }

            .section-title {
                margin-bottom: 6px;
                padding-bottom: 3px;
            }
        }

        /* Section Title */
        .section-title {
            font-size: 11px;
            font-weight: 700;
            color: #000000;
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 2px solid #000000;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            padding-top: 0;
            border-top: none;
            justify-content: center;
            background: transparent;
            padding-bottom: 0;
        }

        .btn {
            padding: 12px 32px;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid #000000;
            background-color: #ffffff;
            color: #000000;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-family: 'Times New Roman', Times, serif;
        }

        .btn-print:hover {
            background-color: #000000;
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <!-- Header -->
        <div class="invoice-header">
            <div class="company-info">
                <div class="logo-icon">
                    <img src="images/logo.jpg" alt="VinFast Logo">
                </div>
                <!-- <div class="company-text">
                    <h1>VINFAST</h1>
                    <p>VinFast Cộng Hòa</p>
                </div> -->
            </div>
            <div class="invoice-title">
                <h2>HÓA ĐƠN BÁO GIÁ</h2>
                <p><strong>Mã đơn:</strong> <span id="invoiceNo">VF-2025-001</span></p>
                <p><strong>Ngày tạo:</strong> <span id="invoiceDate">05/11/2025</span></p>
            </div>
        </div>

        <!-- Customer Information -->
        <!-- <div class="section-title">Thông tin khách hàng</div> -->
        <div class="customer-section">
            <div class="info-block">
                <h3>Họ tên khách hàng</h3>
                <p id="customerName">Nguyễn Văn A</p>
            </div>
            <div class="info-block">
                <h3>Số điện thoại</h3>
                <p id="customerPhone">0123 456 789</p>
            </div>
            <div class="info-block">
                <h3>Email</h3>
                <p id="customerEmail">nguyenvana@email.com</p>
            </div>
            <div class="info-block">
                <h3>Địa chỉ</h3>
                <p id="customerAddress">123 Đường ABC, Quận 1, TP. Hồ Chí Minh</p>
            </div>
            <div class="info-block">
                <h3>Loại khách hàng</h3>
                <p id="customerType">Cá nhân</p>
            </div>
            <div class="info-block">
                <h3>Ngày nhận cọc</h3>
                <p id="depositDate">10/11/2025</p>
            </div>
            <div class="info-block">
                <h3>Ngày hẹn giao xe</h3>
                <p id="deliveryDate">10/12/2025</p>
            </div>
            <div class="info-block">
                <h3>Số tiền cọc</h3>
                <p id="depositAmount">100.000.000 ₫</p>
            </div>
        </div>

        <!-- Vehicle & On-Road Costs Combined -->
        <!-- <div class="section-title">Thông tin xe & Chi phí</div> -->
        <table class="product-table">
            <thead>
                <tr>
                    <th>Sản phẩm/Dịch vụ</th>
                    <th>SL</th>
                    <th>Đơn giá</th>
                    <th>Giảm giá</th>
                    <th>Thành tiền</th>
                </tr>
            </thead>
            <tbody id="productTableBody">
                <tr>
                    <td>
                        <div class="product-name" id="carFullName">VF 7 Tiêu chuẩn</div>
                        <div class="product-description" id="carDescription">
                            Ngoại thất: Xám bạc<br>
                            Nội thất: Đen<br>
                            Đăng ký: TP. Hồ Chí Minh
                        </div>
                    </td>
                    <td>1</td>
                    <td id="carBasePrice">850.000.000 ₫</td>
                    <td id="carDiscount">0 ₫</td>
                    <td id="carTotal">850.000.000 ₫</td>
                </tr>
                <tr>
                    <td>
                        <div class="product-name">Phí biển số</div>
                        <div class="product-description" id="plateLocation">TP. Hồ Chí Minh</div>
                    </td>
                    <td>1</td>
                    <td id="plateFee">20.000.000 ₫</td>
                    <td>0 ₫</td>
                    <td id="plateFeeTotal">20.000.000 ₫</td>
                </tr>
                <tr>
                    <td>
                        <div class="product-name">Phí lưu hành đường bộ</div>
                        <div class="product-description">1 năm</div>
                    </td>
                    <td>1</td>
                    <td id="roadFee">1.560.000 ₫</td>
                    <td>0 ₫</td>
                    <td id="roadFeeTotal">1.560.000 ₫</td>
                </tr>
                <tr>
                    <td>
                        <div class="product-name">Bảo hiểm TNDS</div>
                        <div class="product-description">1 năm</div>
                    </td>
                    <td>1</td>
                    <td id="liabilityInsurance">480.700 ₫</td>
                    <td>0 ₫</td>
                    <td id="liabilityInsuranceTotal">480.700 ₫</td>
                </tr>
                <tr>
                    <td>
                        <div class="product-name">Phí đăng kiểm</div>
                        <div class="product-description">Phí ban đầu</div>
                    </td>
                    <td>1</td>
                    <td id="inspectionFee">90.000 ₫</td>
                    <td>0 ₫</td>
                    <td id="inspectionFeeTotal">90.000 ₫</td>
                </tr>
                <tr>
                    <td>
                        <div class="product-name">Bảo hiểm thân vỏ</div>
                        <div class="product-description" id="bodyInsuranceDesc">1.5% giá trị xe - 1 năm</div>
                    </td>
                    <td>1</td>
                    <td id="bodyInsurance">12.750.000 ₫</td>
                    <td>0 ₫</td>
                    <td id="bodyInsuranceTotal">12.750.000 ₫</td>
                </tr>
                <tr>
                    <td>
                        <div class="product-name">Chi phí dịch vụ đăng ký</div>
                        <div class="product-description">Dịch vụ hỗ trợ đăng ký xe</div>
                    </td>
                    <td>1</td>
                    <td id="registrationFee">3.900.000 ₫</td>
                    <td>0 ₫</td>
                    <td id="registrationFeeTotal">3.900.000 ₫</td>
                </tr>
            </tbody>
        </table>

        <!-- Totals -->
        <div class="totals-section">
            <div class="totals">
                <div class="total-row">
                    <span>Giá xe (gồm VAT):</span>
                    <span id="subtotalCar">850.000.000 ₫</span>
                </div>
                <div class="total-row">
                    <span>Tổng giảm giá:</span>
                    <span id="totalDiscount" style="color: #e53e3e;">0 ₫</span>
                </div>
                <div class="total-row subtotal">
                    <span>Giá xe sau ưu đãi:</span>
                    <span id="subtotal">850.000.000 ₫</span>
                </div>
                <div class="total-row">
                    <span>Tổng chi phí lăn bánh:</span>
                    <span id="totalOnRoadCost">38.780.700 ₫</span>
                </div>
                <div class="total-row grand-total">
                    <span>TỔNG CHI PHÍ:</span>
                    <span id="grandTotal">888.780.700 ₫</span>
                </div>
            </div>
        </div>

        <!-- Payment Section (for installment) -->
        <div class="payment-section" id="paymentSection" style="display: none;">
            <h3>CHI TIẾT TRẢ GÓP</h3>
            <div class="payment-info">
                <div class="payment-item">
                    <span class="label">Tỷ lệ vay:</span>
                    <span class="value" id="loanRatio">70%</span>
                </div>
                <div class="payment-item">
                    <span class="label">Thời hạn vay:</span>
                    <span class="value" id="loanTerm">60 tháng</span>
                </div>
                <div class="payment-item">
                    <span class="label">Lãi suất/năm:</span>
                    <span class="value" id="interestRate">9.5%</span>
                </div>
                <div class="payment-item">
                    <span class="label">Số tiền trả trước:</span>
                    <span class="value" id="downPayment">266.634.210 ₫</span>
                </div>
                <div class="payment-item">
                    <span class="label">Số tiền vay:</span>
                    <span class="value" id="loanAmount">622.146.490 ₫</span>
                </div>
                <div class="payment-item">
                    <span class="label">Tổng lãi phải trả:</span>
                    <span class="value" id="totalInterest">170.979.967 ₫</span>
                </div>
            </div>
            <div style="margin-top: 8px; padding: 8px; background: white; border: 1px solid #000000;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 11px; font-weight: 700; color: #000000; font-family: 'Times New Roman', Times, serif;">Gốc & lãi hàng tháng:</span>
                    <span style="font-size: 12px; font-weight: 700; color: #000000; font-family: 'Times New Roman', Times, serif;" id="monthlyPayment">13.218.774 ₫</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="invoice-footer">
            <p><strong>VINFAST - Đông Sài Gòn</strong></p>
            <p>Cảm ơn quý khách đã tin tưởng và lựa chọn sản phẩm của VinFast!</p>
            <p>Mọi thắc mắc xin vui lòng liên hệ hotline hoặc showroom để được hỗ trợ.</p>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons no-print">
            <button class="btn btn-print" onclick="window.print()">
                IN BÁO GIÁ
            </button>
        </div>
    </div>

    <!-- Import database.js if needed -->
    <script src="database.js"></script>

    <script>
        // Print to PDF function - uses browser's print dialog
        function printToPDF() {
            // Show instruction
            const userAgent = navigator.userAgent.toLowerCase();
            const isMac = userAgent.indexOf('mac') !== -1;
            const isChrome = userAgent.indexOf('chrome') !== -1;
            
            let instruction = 'Hướng dẫn lưu PDF:\n\n';
            if (isMac) {
                instruction += '1. Nhấn Command + P (hoặc chọn File > Print)\n';
                instruction += '2. Ở phần "Destination", chọn "Save as PDF"\n';
                instruction += '3. Nhấn "Save" để lưu file PDF';
            } else {
                instruction += '1. Nhấn Ctrl + P (hoặc chọn File > Print)\n';
                instruction += '2. Ở phần "Destination" hoặc "Printer", chọn "Save as PDF"\n';
                instruction += '3. Nhấn "Save" để lưu file PDF';
            }
            
            if (confirm(instruction + '\n\nNhấn OK để mở hộp thoại in')) {
                window.print();
            }
        }

        // Format currency helper
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN').format(Math.round(amount)) + ' ₫';
        }

        // Format date helper
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Toggle payment section
        function togglePaymentSection(show) {
            const section = document.getElementById('paymentSection');
            section.style.display = show ? 'block' : 'none';
        }

        // Function to update invoice data from calculator
        function updateInvoice(data) {
            console.log('Updating invoice with data:', data);
            
            // Update header info
            if (data.invoiceNo) document.getElementById('invoiceNo').textContent = data.invoiceNo;
            if (data.invoiceDate) document.getElementById('invoiceDate').textContent = formatDate(data.invoiceDate);
            
            // Update customer info
            if (data.customerName) document.getElementById('customerName').textContent = data.customerName;
            if (data.customerPhone) document.getElementById('customerPhone').textContent = data.customerPhone;
            if (data.customerEmail) document.getElementById('customerEmail').textContent = data.customerEmail;
            if (data.customerAddress) document.getElementById('customerAddress').textContent = data.customerAddress;
            if (data.customerType) {
                const typeText = data.customerType === 'ca_nhan' ? 'Cá nhân' : 'Công ty';
                document.getElementById('customerType').textContent = typeText;
            }
            if (data.depositDate) document.getElementById('depositDate').textContent = formatDate(data.depositDate);
            if (data.deliveryDate) document.getElementById('deliveryDate').textContent = formatDate(data.deliveryDate);
            if (data.depositAmount !== undefined) {
                document.getElementById('depositAmount').textContent = formatCurrency(data.depositAmount);
            }
            
            // Update car info
            if (data.carModel && data.carVersion) {
                document.getElementById('carFullName').textContent = `${data.carModel} ${data.carVersion}`;
            }
            if (data.exteriorColor || data.interiorColor || data.registrationLocation) {
                let description = '';
                if (data.exteriorColor) description += `Ngoại thất: ${data.exteriorColor}<br>`;
                if (data.interiorColor) description += `Nội thất: ${data.interiorColor}<br>`;
                if (data.registrationLocation) description += `Đăng ký: ${data.registrationLocation}`;
                document.getElementById('carDescription').innerHTML = description;
            }
            
            // Update car prices
            if (data.carBasePrice !== undefined) {
                document.getElementById('carBasePrice').textContent = formatCurrency(data.carBasePrice);
                document.getElementById('subtotalCar').textContent = formatCurrency(data.carBasePrice);
            }
            if (data.carDiscount !== undefined) {
                document.getElementById('carDiscount').textContent = formatCurrency(data.carDiscount);
                document.getElementById('totalDiscount').textContent = formatCurrency(data.carDiscount);
            }
            if (data.carTotal !== undefined) {
                document.getElementById('carTotal').textContent = formatCurrency(data.carTotal);
                document.getElementById('subtotal').textContent = formatCurrency(data.carTotal);
            }
            
            // Update on-road costs
            if (data.plateFee !== undefined) {
                document.getElementById('plateFee').textContent = formatCurrency(data.plateFee);
                document.getElementById('plateFeeTotal').textContent = formatCurrency(data.plateFee);
            }
            if (data.plateLocation) {
                document.getElementById('plateLocation').textContent = data.plateLocation;
            }
            if (data.roadFee !== undefined) {
                document.getElementById('roadFee').textContent = formatCurrency(data.roadFee);
                document.getElementById('roadFeeTotal').textContent = formatCurrency(data.roadFee);
            }
            if (data.liabilityInsurance !== undefined) {
                document.getElementById('liabilityInsurance').textContent = formatCurrency(data.liabilityInsurance);
                document.getElementById('liabilityInsuranceTotal').textContent = formatCurrency(data.liabilityInsurance);
            }
            if (data.inspectionFee !== undefined) {
                document.getElementById('inspectionFee').textContent = formatCurrency(data.inspectionFee);
                document.getElementById('inspectionFeeTotal').textContent = formatCurrency(data.inspectionFee);
            }
            if (data.bodyInsurance !== undefined) {
                document.getElementById('bodyInsurance').textContent = formatCurrency(data.bodyInsurance);
                document.getElementById('bodyInsuranceTotal').textContent = formatCurrency(data.bodyInsurance);
            }
            if (data.bodyInsuranceRate) {
                document.getElementById('bodyInsuranceDesc').textContent = `${(data.bodyInsuranceRate * 100).toFixed(1)}% giá trị xe - 1 năm`;
            }
            if (data.registrationFee !== undefined) {
                document.getElementById('registrationFee').textContent = formatCurrency(data.registrationFee);
                document.getElementById('registrationFeeTotal').textContent = formatCurrency(data.registrationFee);
            }
            
            // Update totals
            if (data.totalOnRoadCost !== undefined) {
                document.getElementById('totalOnRoadCost').textContent = formatCurrency(data.totalOnRoadCost);
            }
            if (data.grandTotal !== undefined) {
                document.getElementById('grandTotal').textContent = formatCurrency(data.grandTotal);
            }
            
            // Update payment/loan info if exists
            if (data.hasLoan) {
                togglePaymentSection(true);
                if (data.loanRatio !== undefined) {
                    document.getElementById('loanRatio').textContent = `${data.loanRatio}%`;
                }
                if (data.loanTerm !== undefined) {
                    document.getElementById('loanTerm').textContent = `${data.loanTerm} tháng`;
                }
                if (data.interestRate !== undefined) {
                    document.getElementById('interestRate').textContent = `${(data.interestRate * 100).toFixed(1)}%`;
                }
                if (data.downPayment !== undefined) {
                    document.getElementById('downPayment').textContent = formatCurrency(data.downPayment);
                }
                if (data.loanAmount !== undefined) {
                    document.getElementById('loanAmount').textContent = formatCurrency(data.loanAmount);
                }
                if (data.totalInterest !== undefined) {
                    document.getElementById('totalInterest').textContent = formatCurrency(data.totalInterest);
                }
                if (data.monthlyPayment !== undefined) {
                    document.getElementById('monthlyPayment').textContent = formatCurrency(data.monthlyPayment);
                }
            } else {
                togglePaymentSection(false);
            }
        }

        // Initialize with default data or data from localStorage
        window.addEventListener('DOMContentLoaded', function() {
            // Check if there's data passed from calculator
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');
            
            if (dataParam) {
                try {
                    const data = JSON.parse(decodeURIComponent(dataParam));
                    updateInvoice(data);
                } catch (e) {
                    console.error('Error parsing invoice data:', e);
                }
            }
            
            // Or check localStorage
            const savedData = localStorage.getItem('invoiceData');
            if (savedData && !dataParam) {
                try {
                    const data = JSON.parse(savedData);
                    updateInvoice(data);
                } catch (e) {
                    console.error('Error loading saved invoice data:', e);
                }
            }
        });
    </script>
</body>
</html>
