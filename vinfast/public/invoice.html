<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice - VinFast</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            font-size: 11px;
        }

        .invoice-container {
            max-width: 850px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        /* Header */
        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .company-info {
            display: flex;
            align-items: center;
            gap: 0;
        }

        .logo-icon {
            width: 35px;
            height: 35px;
            border-radius: 6px;
            display: none;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .company-text h1 {
            color: #000000;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .company-text p {
            color: #2d3748;
            font-size: 9px;
            line-height: 1.2;
        }

        .invoice-title {
            text-align: right;
        }

        .invoice-title h2 {
            font-size: 18px;
            color: #1a202c;
            margin-bottom: 4px;
            font-weight: 700;
        }

        .invoice-title p {
            color: #2d3748;
            font-size: 9px;
            font-weight: 500;
        }

        /* Customer Info */
        .customer-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 10px;
            margin-bottom: 12px;
            padding: 10px;
            background-color: #f7fafc;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .info-block h3 {
            font-size: 8px;
            color: #4a5568;
            margin-bottom: 3px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .info-block p {
            font-size: 10px;
            color: #000000;
            line-height: 1.3;
            font-weight: 500;
        }

        .info-block p strong {
            font-weight: 600;
            color: #000000;
        }

        /* Product Table */
        .product-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
            margin-top: 16px;
        }

        .product-table thead {
            background-color: #f7fafc;
            border-bottom: 2px solid #cbd5e0;
        }

        .product-table th {
            padding: 10px 8px;
            text-align: left;
            font-size: 10px;
            font-weight: 600;
            color: #1a202c;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .product-table th:nth-child(2),
        .product-table th:nth-child(3),
        .product-table th:nth-child(4),
        .product-table th:nth-child(5) {
            text-align: right;
        }

        .product-table td {
            padding: 10px 8px;
            font-size: 12px;
            color: #000000;
            border-bottom: 1px solid #e2e8f0;
        }

        .product-table td:nth-child(2),
        .product-table td:nth-child(3),
        .product-table td:nth-child(4),
        .product-table td:nth-child(5) {
            text-align: right;
            font-weight: 500;
        }

        .product-name {
            font-weight: 600;
            margin-bottom: 3px;
            color: #000000;
        }

        .product-description {
            font-size: 10px;
            color: #4a5568;
            line-height: 1.3;
        }

        /* Totals */
        .totals-section {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .totals {
            width: 100%;
            background-color: #f7fafc;
            padding: 12px;
            border-radius: 6px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 11px;
            font-weight: 500;
            color: #2d3748;
        }

        .total-row span:last-child {
            color: #000000;
            font-weight: 600;
        }

        .total-row.subtotal {
            border-top: 1px solid #cbd5e0;
            padding-top: 7px;
        }

        .total-row.grand-total {
            border-top: 2px solid #1a202c;
            font-weight: 700;
            font-size: 14px;
            color: #1a202c;
            padding-top: 7px;
            margin-top: 6px;
        }

        .total-row.grand-total span:last-child {
            color: #000000;
        }

        /* Payment Section */
        .payment-section {
            margin-top: 12px;
            padding: 10px;
            background-color: #f7fafc;
            border-radius: 6px;
            border-left: 3px solid #1a202c;
        }

        .payment-section h3 {
            font-size: 11px;
            color: #1a202c;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .payment-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 6px;
        }

        .payment-item {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            padding: 5px 8px;
            background-color: white;
            border-radius: 4px;
        }

        .payment-item .label {
            color: #2d3748;
            font-weight: 500;
        }

        .payment-item .value {
            font-weight: 600;
            color: #000000;
        }

        /* Footer */
        .invoice-footer {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 2px solid #e2e8f0;
            text-align: center;
        }

        .invoice-footer p {
            color: #4a5568;
            font-size: 9px;
            line-height: 1.3;
            margin: 1px 0;
        }

        .invoice-footer strong {
            color: #1a202c;
            font-size: 10px;
        }

        /* Print Styles */
        @media print {
            body {
                background-color: white;
                padding: 0;
                font-size: 10px;
            }

            .invoice-container {
                box-shadow: none;
                padding: 15px;
                max-width: 100%;
                margin: 0;
            }

            .no-print,
            .action-buttons {
                display: none !important;
            }

            .invoice-footer {
                page-break-inside: avoid;
            }

            /* Hide entire logo container in print to avoid white space */
            .logo-icon {
                display: none !important;
            }

            .company-info {
                gap: 0 !important;
            }

            /* Reduce spacing for print */
            .invoice-header {
                margin-bottom: 8px;
                padding-bottom: 8px;
            }

            .customer-section {
                margin-bottom: 8px;
                padding: 8px;
                gap: 8px;
            }

            .product-table {
                margin-top: 8px;
                margin-bottom: 8px;
            }

            .totals-section {
                margin-top: 8px;
                margin-bottom: 8px;
            }

            .payment-section {
                margin-top: 8px;
                padding: 8px;
            }

            .invoice-footer {
                margin-top: 10px;
                padding-top: 8px;
            }

            .section-title {
                margin-bottom: 6px;
                padding-bottom: 3px;
            }
        }

        /* Section Title */
        .section-title {
            font-size: 11px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 2px solid #cbd5e0;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 3px dashed #cbd5e0;
            justify-content: center;
            background: linear-gradient(to bottom, #f7fafc 0%, #ffffff 100%);
            border-radius: 0 0 8px 8px;
            padding-bottom: 8px;
        }

        .btn {
            padding: 12px 32px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-print {
            background-color: #3182ce;
            color: white;
        }

        .btn-print:hover {
            background-color: #2c5282;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(49, 130, 206, 0.4);
        }

        .btn-download {
            background-color: #38a169;
            color: white;
        }

        .btn-download:hover {
            background-color: #2f855a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(56, 161, 105, 0.4);
        }

        .btn-download:disabled {
            background-color: #a0aec0;
            cursor: not-allowed;
            transform: none;
        }

        .btn-email {
            background-color: #ed8936;
            color: white;
        }

        .btn-email:hover {
            background-color: #dd6b20;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(237, 137, 54, 0.4);
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <!-- Header -->
        <div class="invoice-header">
            <div class="company-info">
                <div class="logo-icon">
                    <img src="images/logo.jpg" alt="VinFast Logo" crossorigin="anonymous">
                </div>
                <div class="company-text">
                    <h1>VINFAST</h1>
                    <p>VinFast C·ªông H√≤a</p>
                </div>
            </div>
            <div class="invoice-title">
                <h2>H√ìA ƒê∆†N B√ÅO GI√Å</h2>
                <p><strong>M√£ ƒë∆°n:</strong> <span id="invoiceNo">VF-2025-001</span></p>
                <p><strong>Ng√†y t·∫°o:</strong> <span id="invoiceDate">05/11/2025</span></p>
            </div>
        </div>

        <!-- Customer Information -->
        <!-- <div class="section-title">Th√¥ng tin kh√°ch h√†ng</div> -->
        <div class="customer-section">
            <div class="info-block">
                <h3>H·ªç t√™n kh√°ch h√†ng</h3>
                <p id="customerName">Nguy·ªÖn VƒÉn A</p>
            </div>
            <div class="info-block">
                <h3>S·ªë ƒëi·ªán tho·∫°i</h3>
                <p id="customerPhone">0123 456 789</p>
            </div>
            <div class="info-block">
                <h3>Email</h3>
                <p id="customerEmail">nguyenvana@email.com</p>
            </div>
            <div class="info-block">
                <h3>ƒê·ªãa ch·ªâ</h3>
                <p id="customerAddress">123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP. H·ªì Ch√≠ Minh</p>
            </div>
            <div class="info-block">
                <h3>Lo·∫°i kh√°ch h√†ng</h3>
                <p id="customerType">C√° nh√¢n</p>
            </div>
            <div class="info-block">
                <h3>Ng√†y nh·∫≠n c·ªçc</h3>
                <p id="depositDate">10/11/2025</p>
            </div>
            <div class="info-block">
                <h3>Ng√†y h·∫πn giao xe</h3>
                <p id="deliveryDate">10/12/2025</p>
            </div>
            <div class="info-block">
                <h3>S·ªë ti·ªÅn c·ªçc</h3>
                <p id="depositAmount">100.000.000 ‚Ç´</p>
            </div>
        </div>

        <!-- Vehicle & On-Road Costs Combined -->
        <!-- <div class="section-title">Th√¥ng tin xe & Chi ph√≠</div> -->
        <table class="product-table">
            <thead>
                <tr>
                    <th>S·∫£n ph·∫©m/D·ªãch v·ª•</th>
                    <th>SL</th>
                    <th>ƒê∆°n gi√°</th>
                    <th>Gi·∫£m gi√°</th>
                    <th>Th√†nh ti·ªÅn</th>
                </tr>
            </thead>
            <tbody id="productTableBody">
                <tr>
                    <td>
                        <div class="product-name" id="carFullName">VF 7 Ti√™u chu·∫©n</div>
                        <div class="product-description" id="carDescription">
                            Ngo·∫°i th·∫•t: X√°m b·∫°c<br>
                            N·ªôi th·∫•t: ƒêen<br>
                            ƒêƒÉng k√Ω: TP. H·ªì Ch√≠ Minh
                        </div>
                    </td>
                    <td>1</td>
                    <td id="carBasePrice">850.000.000 ‚Ç´</td>
                    <td id="carDiscount">0 ‚Ç´</td>
                    <td id="carTotal">850.000.000 ‚Ç´</td>
                </tr>
                <tr>
                    <td>
                        <div class="product-name">Ph√≠ bi·ªÉn s·ªë</div>
                        <div class="product-description" id="plateLocation">TP. H·ªì Ch√≠ Minh</div>
                    </td>
                    <td>1</td>
                    <td id="plateFee">20.000.000 ‚Ç´</td>
                    <td>0 ‚Ç´</td>
                    <td id="plateFeeTotal">20.000.000 ‚Ç´</td>
                </tr>
                <tr>
                    <td>
                        <div class="product-name">Ph√≠ l∆∞u h√†nh ƒë∆∞·ªùng b·ªô</div>
                        <div class="product-description">1 nƒÉm</div>
                    </td>
                    <td>1</td>
                    <td id="roadFee">1.560.000 ‚Ç´</td>
                    <td>0 ‚Ç´</td>
                    <td id="roadFeeTotal">1.560.000 ‚Ç´</td>
                </tr>
                <tr>
                    <td>
                        <div class="product-name">B·∫£o hi·ªÉm TNDS</div>
                        <div class="product-description">1 nƒÉm</div>
                    </td>
                    <td>1</td>
                    <td id="liabilityInsurance">480.700 ‚Ç´</td>
                    <td>0 ‚Ç´</td>
                    <td id="liabilityInsuranceTotal">480.700 ‚Ç´</td>
                </tr>
                <tr>
                    <td>
                        <div class="product-name">Ph√≠ ƒëƒÉng ki·ªÉm</div>
                        <div class="product-description">Ph√≠ ban ƒë·∫ßu</div>
                    </td>
                    <td>1</td>
                    <td id="inspectionFee">90.000 ‚Ç´</td>
                    <td>0 ‚Ç´</td>
                    <td id="inspectionFeeTotal">90.000 ‚Ç´</td>
                </tr>
                <tr>
                    <td>
                        <div class="product-name">B·∫£o hi·ªÉm th√¢n v·ªè</div>
                        <div class="product-description" id="bodyInsuranceDesc">1.5% gi√° tr·ªã xe - 1 nƒÉm</div>
                    </td>
                    <td>1</td>
                    <td id="bodyInsurance">12.750.000 ‚Ç´</td>
                    <td>0 ‚Ç´</td>
                    <td id="bodyInsuranceTotal">12.750.000 ‚Ç´</td>
                </tr>
                <tr>
                    <td>
                        <div class="product-name">Chi ph√≠ d·ªãch v·ª• ƒëƒÉng k√Ω</div>
                        <div class="product-description">D·ªãch v·ª• h·ªó tr·ª£ ƒëƒÉng k√Ω xe</div>
                    </td>
                    <td>1</td>
                    <td id="registrationFee">3.900.000 ‚Ç´</td>
                    <td>0 ‚Ç´</td>
                    <td id="registrationFeeTotal">3.900.000 ‚Ç´</td>
                </tr>
            </tbody>
        </table>

        <!-- Totals -->
        <div class="totals-section">
            <div class="totals">
                <div class="total-row">
                    <span>Gi√° xe (g·ªìm VAT):</span>
                    <span id="subtotalCar">850.000.000 ‚Ç´</span>
                </div>
                <div class="total-row">
                    <span>T·ªïng gi·∫£m gi√°:</span>
                    <span id="totalDiscount" style="color: #e53e3e;">0 ‚Ç´</span>
                </div>
                <div class="total-row subtotal">
                    <span>Gi√° xe sau ∆∞u ƒë√£i:</span>
                    <span id="subtotal">850.000.000 ‚Ç´</span>
                </div>
                <div class="total-row">
                    <span>T·ªïng chi ph√≠ lƒÉn b√°nh:</span>
                    <span id="totalOnRoadCost">38.780.700 ‚Ç´</span>
                </div>
                <div class="total-row grand-total">
                    <span>T·ªîNG CHI PH√ç:</span>
                    <span id="grandTotal">888.780.700 ‚Ç´</span>
                </div>
            </div>
        </div>

        <!-- Payment Section (for installment) -->
        <div class="payment-section" id="paymentSection" style="display: none;">
            <h3>üìã Chi ti·∫øt tr·∫£ g√≥p</h3>
            <div class="payment-info">
                <div class="payment-item">
                    <span class="label">T·ª∑ l·ªá vay:</span>
                    <span class="value" id="loanRatio">70%</span>
                </div>
                <div class="payment-item">
                    <span class="label">Th·ªùi h·∫°n vay:</span>
                    <span class="value" id="loanTerm">60 th√°ng</span>
                </div>
                <div class="payment-item">
                    <span class="label">L√£i su·∫•t/nƒÉm:</span>
                    <span class="value" id="interestRate">9.5%</span>
                </div>
                <div class="payment-item">
                    <span class="label">S·ªë ti·ªÅn tr·∫£ tr∆∞·ªõc:</span>
                    <span class="value" id="downPayment">266.634.210 ‚Ç´</span>
                </div>
                <div class="payment-item">
                    <span class="label">S·ªë ti·ªÅn vay:</span>
                    <span class="value" id="loanAmount">622.146.490 ‚Ç´</span>
                </div>
                <div class="payment-item">
                    <span class="label">T·ªïng l√£i ph·∫£i tr·∫£:</span>
                    <span class="value" id="totalInterest">170.979.967 ‚Ç´</span>
                </div>
            </div>
            <div style="margin-top: 8px; padding: 8px; background: white; border-radius: 4px; border: 2px solid #1a202c;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 10px; font-weight: 600; color: #1a202c;">G·ªëc & l√£i h√†ng th√°ng:</span>
                    <span style="font-size: 11px; font-weight: 700; color: #000000;" id="monthlyPayment">13.218.774 ‚Ç´</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="invoice-footer">
            <p><strong>VINFAST - VinFast C·ªông H√≤a</strong></p>
            <p>C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ tin t∆∞·ªüng v√† l·ª±a ch·ªçn s·∫£n ph·∫©m c·ªßa VinFast!</p>
            <p>M·ªçi th·∫Øc m·∫Øc xin vui l√≤ng li√™n h·ªá hotline ho·∫∑c showroom ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£.</p>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons no-print">
            <button class="btn btn-print" onclick="window.print()">
                üñ®Ô∏è In b√°o gi√°
            </button>
        </div>
    </div>

    <!-- Import database.js if needed -->
    <script src="database.js"></script>

    <script>
        // Print to PDF function - uses browser's print dialog
        function printToPDF() {
            // Show instruction
            const userAgent = navigator.userAgent.toLowerCase();
            const isMac = userAgent.indexOf('mac') !== -1;
            const isChrome = userAgent.indexOf('chrome') !== -1;
            
            let instruction = 'H∆∞·ªõng d·∫´n l∆∞u PDF:\n\n';
            if (isMac) {
                instruction += '1. Nh·∫•n Command + P (ho·∫∑c ch·ªçn File > Print)\n';
                instruction += '2. ·ªû ph·∫ßn "Destination", ch·ªçn "Save as PDF"\n';
                instruction += '3. Nh·∫•n "Save" ƒë·ªÉ l∆∞u file PDF';
            } else {
                instruction += '1. Nh·∫•n Ctrl + P (ho·∫∑c ch·ªçn File > Print)\n';
                instruction += '2. ·ªû ph·∫ßn "Destination" ho·∫∑c "Printer", ch·ªçn "Save as PDF"\n';
                instruction += '3. Nh·∫•n "Save" ƒë·ªÉ l∆∞u file PDF';
            }
            
            if (confirm(instruction + '\n\nNh·∫•n OK ƒë·ªÉ m·ªü h·ªôp tho·∫°i in')) {
                window.print();
            }
        }

        // Format currency helper
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN').format(Math.round(amount)) + ' ‚Ç´';
        }

        // Format date helper
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Toggle payment section
        function togglePaymentSection(show) {
            const section = document.getElementById('paymentSection');
            section.style.display = show ? 'block' : 'none';
        }

        // Function to update invoice data from calculator
        function updateInvoice(data) {
            console.log('Updating invoice with data:', data);
            
            // Update header info
            if (data.invoiceNo) document.getElementById('invoiceNo').textContent = data.invoiceNo;
            if (data.invoiceDate) document.getElementById('invoiceDate').textContent = formatDate(data.invoiceDate);
            
            // Update customer info
            if (data.customerName) document.getElementById('customerName').textContent = data.customerName;
            if (data.customerPhone) document.getElementById('customerPhone').textContent = data.customerPhone;
            if (data.customerEmail) document.getElementById('customerEmail').textContent = data.customerEmail;
            if (data.customerAddress) document.getElementById('customerAddress').textContent = data.customerAddress;
            if (data.customerType) {
                const typeText = data.customerType === 'ca_nhan' ? 'C√° nh√¢n' : 'C√¥ng ty';
                document.getElementById('customerType').textContent = typeText;
            }
            if (data.depositDate) document.getElementById('depositDate').textContent = formatDate(data.depositDate);
            if (data.deliveryDate) document.getElementById('deliveryDate').textContent = formatDate(data.deliveryDate);
            if (data.depositAmount !== undefined) {
                document.getElementById('depositAmount').textContent = formatCurrency(data.depositAmount);
            }
            
            // Update car info
            if (data.carModel && data.carVersion) {
                document.getElementById('carFullName').textContent = `${data.carModel} ${data.carVersion}`;
            }
            if (data.exteriorColor || data.interiorColor || data.registrationLocation) {
                let description = '';
                if (data.exteriorColor) description += `Ngo·∫°i th·∫•t: ${data.exteriorColor}<br>`;
                if (data.interiorColor) description += `N·ªôi th·∫•t: ${data.interiorColor}<br>`;
                if (data.registrationLocation) description += `ƒêƒÉng k√Ω: ${data.registrationLocation}`;
                document.getElementById('carDescription').innerHTML = description;
            }
            
            // Update car prices
            if (data.carBasePrice !== undefined) {
                document.getElementById('carBasePrice').textContent = formatCurrency(data.carBasePrice);
                document.getElementById('subtotalCar').textContent = formatCurrency(data.carBasePrice);
            }
            if (data.carDiscount !== undefined) {
                document.getElementById('carDiscount').textContent = formatCurrency(data.carDiscount);
                document.getElementById('totalDiscount').textContent = formatCurrency(data.carDiscount);
            }
            if (data.carTotal !== undefined) {
                document.getElementById('carTotal').textContent = formatCurrency(data.carTotal);
                document.getElementById('subtotal').textContent = formatCurrency(data.carTotal);
            }
            
            // Update on-road costs
            if (data.plateFee !== undefined) {
                document.getElementById('plateFee').textContent = formatCurrency(data.plateFee);
                document.getElementById('plateFeeTotal').textContent = formatCurrency(data.plateFee);
            }
            if (data.plateLocation) {
                document.getElementById('plateLocation').textContent = data.plateLocation;
            }
            if (data.roadFee !== undefined) {
                document.getElementById('roadFee').textContent = formatCurrency(data.roadFee);
                document.getElementById('roadFeeTotal').textContent = formatCurrency(data.roadFee);
            }
            if (data.liabilityInsurance !== undefined) {
                document.getElementById('liabilityInsurance').textContent = formatCurrency(data.liabilityInsurance);
                document.getElementById('liabilityInsuranceTotal').textContent = formatCurrency(data.liabilityInsurance);
            }
            if (data.inspectionFee !== undefined) {
                document.getElementById('inspectionFee').textContent = formatCurrency(data.inspectionFee);
                document.getElementById('inspectionFeeTotal').textContent = formatCurrency(data.inspectionFee);
            }
            if (data.bodyInsurance !== undefined) {
                document.getElementById('bodyInsurance').textContent = formatCurrency(data.bodyInsurance);
                document.getElementById('bodyInsuranceTotal').textContent = formatCurrency(data.bodyInsurance);
            }
            if (data.bodyInsuranceRate) {
                document.getElementById('bodyInsuranceDesc').textContent = `${(data.bodyInsuranceRate * 100).toFixed(1)}% gi√° tr·ªã xe - 1 nƒÉm`;
            }
            if (data.registrationFee !== undefined) {
                document.getElementById('registrationFee').textContent = formatCurrency(data.registrationFee);
                document.getElementById('registrationFeeTotal').textContent = formatCurrency(data.registrationFee);
            }
            
            // Update totals
            if (data.totalOnRoadCost !== undefined) {
                document.getElementById('totalOnRoadCost').textContent = formatCurrency(data.totalOnRoadCost);
            }
            if (data.grandTotal !== undefined) {
                document.getElementById('grandTotal').textContent = formatCurrency(data.grandTotal);
            }
            
            // Update payment/loan info if exists
            if (data.hasLoan) {
                togglePaymentSection(true);
                if (data.loanRatio !== undefined) {
                    document.getElementById('loanRatio').textContent = `${data.loanRatio}%`;
                }
                if (data.loanTerm !== undefined) {
                    document.getElementById('loanTerm').textContent = `${data.loanTerm} th√°ng`;
                }
                if (data.interestRate !== undefined) {
                    document.getElementById('interestRate').textContent = `${(data.interestRate * 100).toFixed(1)}%`;
                }
                if (data.downPayment !== undefined) {
                    document.getElementById('downPayment').textContent = formatCurrency(data.downPayment);
                }
                if (data.loanAmount !== undefined) {
                    document.getElementById('loanAmount').textContent = formatCurrency(data.loanAmount);
                }
                if (data.totalInterest !== undefined) {
                    document.getElementById('totalInterest').textContent = formatCurrency(data.totalInterest);
                }
                if (data.monthlyPayment !== undefined) {
                    document.getElementById('monthlyPayment').textContent = formatCurrency(data.monthlyPayment);
                }
            } else {
                togglePaymentSection(false);
            }
        }

        // Initialize with default data or data from localStorage
        window.addEventListener('DOMContentLoaded', function() {
            // Check if there's data passed from calculator
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');
            
            if (dataParam) {
                try {
                    const data = JSON.parse(decodeURIComponent(dataParam));
                    updateInvoice(data);
                } catch (e) {
                    console.error('Error parsing invoice data:', e);
                }
            }
            
            // Or check localStorage
            const savedData = localStorage.getItem('invoiceData');
            if (savedData && !dataParam) {
                try {
                    const data = JSON.parse(savedData);
                    updateInvoice(data);
                } catch (e) {
                    console.error('Error loading saved invoice data:', e);
                }
            }
        });
    </script>
</body>
</html>
